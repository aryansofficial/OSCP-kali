#!/usr/bin/env python3

import socket
import sys

def load_users(filename):
    """Load usernames from a file, stripping empty lines and whitespace."""
    with open(filename, 'r') as f:
        return [line.strip() for line in f if line.strip()]

def vrfy_user(host, user):
    """Send VRFY command to SMTP server to verify a user."""
    with socket.create_connection((host, 25)) as s:
        fn = s.makefile('rwb')

        fn.readline()  # Banner
        fn.write(b'HELO testing.com\r\n')
        fn.flush()
        fn.readline()  # HELO response

        fn.write(f'VRFY {user}\r\n'.encode())
        fn.flush()
        response = fn.readline().strip().decode()

        fn.write(b'QUIT\r\n')
        fn.flush()

        return response

def main():
    if len(sys.argv) != 3:
        print(f"Usage: {sys.argv[0]} <target_host> <user_list_file>")
        sys.exit(1)

    host = sys.argv[1]
    user_file = sys.argv[2]
    users = load_users(user_file)

    valid_users = []

    for user in users:
        print(f"Checking {user}...")
        result = vrfy_user(host, user)
        print(f'{user}: {result}')
        
        if result.startswith('2'):
            valid_users.append((user, result))

    print("\n[+] Valid Users Found:")
    for user, response in valid_users:
        print(f'{user}: {response}')

if __name__ == '__main__':
    main()
